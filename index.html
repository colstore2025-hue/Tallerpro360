<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nexus-X | TallerPro360 Global</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #020617; --accent: #3b82f6; --gold: #f59e0b; }
        body { font-family: 'Inter', sans-serif; background: var(--primary); color: white; margin: 0; overflow-x: hidden; }
        .font-nexus { font-family: 'Orbitron', sans-serif; }
        
        /* Glassmorphism Interfaz */
        .glass-panel { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); border-radius: 30px; }
        .view-section { display: none; min-height: 100vh; padding: 20px; }
        .view-section.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Botones Élite */
        .btn-main { background: linear-gradient(135deg, var(--accent), #1d4ed8); padding: 18px; border-radius: 20px; font-weight: bold; transition: 0.3s; width: 100%; text-align: center; }
        .btn-gold { background: linear-gradient(135deg, var(--gold), #b45309); color: black; }
    </style>
</head>
<body>

<div id="nexus-loader" class="fixed inset-0 bg-slate-950 z-[9999] flex flex-col items-center justify-center">
    <i class="fas fa-satellite-dish text-gold text-5xl animate-pulse mb-4"></i>
    <p class="font-nexus tracking-widest text-xs">SISTEMA NEXUS-X ACTIVADO</p>
</div>

<section id="view-entry" class="view-section active flex flex-col items-center justify-center p-6 text-center">
    <div class="mb-12">
        <h1 class="font-nexus text-5xl mb-2">NEXUS<span class="text-accent">X</span></h1>
        <p class="text-[9px] tracking-[0.6em] text-gold uppercase">Colombian Trucks Logistics LLC</p>
    </div>

    <div class="w-full max-w-sm space-y-4">
        <div class="glass-panel p-8 space-y-6">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Portal de Servicios</h3>
            <button onclick="switchView('view-client-search')" class="btn-main font-nexus text-sm">RASTREAR MI CAMIÓN</button>
            <button onclick="switchView('view-login')" class="btn-main btn-gold font-nexus text-sm">ACCESO TALLER / SOCIO</button>
        </div>
        <p class="text-[10px] text-slate-600 mt-8">© 2026 Charlotte, NC. USA. Derechos Reservados.</p>
    </div>
</section>

<section id="view-client-search" class="view-section p-6">
    <button onclick="switchView('view-entry')" class="mb-8 text-slate-400"><i class="fas fa-arrow-left mr-2"></i> VOLVER</button>
    <div class="glass-panel p-8 text-center space-y-6">
        <i class="fas fa-truck-moving text-gold text-4xl"></i>
        <h2 class="font-nexus text-xl">STATUS DE UNIDAD</h2>
        <input id="search-placa" placeholder="INGRESA TU PLACA" class="w-full bg-slate-900 p-5 rounded-2xl text-center font-nexus text-2xl border border-slate-700 uppercase">
        <button onclick="processClientSearch()" class="btn-main">CONSULTAR AHORA</button>
    </div>
</section>

<section id="view-login" class="view-section p-6">
    <button onclick="switchView('view-entry')" class="mb-8 text-slate-400"><i class="fas fa-arrow-left mr-2"></i> VOLVER</button>
    <div class="glass-panel p-8 space-y-6 max-w-sm mx-auto">
        <h2 class="font-nexus text-center text-gold">SISTEMA OPERATIVO</h2>
        <input id="login-email" type="email" placeholder="Usuario / Email" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-700">
        <input id="login-pass" type="password" placeholder="Contraseña" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-700">
        <button onclick="handleLogin()" class="btn-main">ESTABLECER ENLACE</button>
    </div>
</section>

<div id="nexus-app-container" class="hidden">
    </div>

<script type="module">
    // --- IMPORTACIÓN DE MÓDULOS FIREBASE ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAdk-s-OXu57MiobzRGBRu-TlF2KYeicWQ",
        authDomain: "tallerpro360.firebaseapp.com",
        projectId: "tallerpro360",
        storageBucket: "tallerpro360.appspot.com",
        messagingSenderId: "636224778184",
        appId: "1:636224778184:web:9bd7351b6458a1ef625afd"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- ROUTER DE VISTAS ---
    window.switchView = (viewId) => {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
    };

    // --- PROCESAR BÚSQUEDA DE CLIENTE ---
    window.processClientSearch = async () => {
        const placa = document.getElementById('search-placa').value.toUpperCase().trim();
        if(!placa) return alert("Ingresa una placa válida");
        
        // Simulación: Aquí cargaría el módulo de cliente.html que ya tenemos
        alert(`Buscando Unidad ${placa} en la red Starlink...`);
        // Lógica de redirección o inyección de código de cliente
    };

    // --- LOGIN UNIFICADO (Taller & CEO) ---
    window.handleLogin = async () => {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, pass);
            // El observador onAuthStateChanged manejará la redirección al módulo correcto
        } catch (error) {
            alert("Acceso denegado: Credenciales no registradas en la red.");
        }
    };

    // --- DETECTOR DE ROL ---
    onAuthStateChanged(auth, async (user) => {
        if(user) {
            if(user.email === 'col.store2025@gmail.com') {
                alert("MODO CEO ACTIVADO");
                // Aquí inyectas el código de ceo.html
            } else {
                alert("ACCESO TALLER AUTORIZADO");
                // Aquí inyectas el código de taller.html
            }
        }
        document.getElementById('nexus-loader').classList.add('hidden');
    });

    window.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => document.getElementById('nexus-loader').classList.add('hidden'), 1500);
    });
</script>
</body>
</html>
