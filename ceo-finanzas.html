<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CEO Â· Dashboard Financiero | TallerPRO360</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script type="module" src="./ceo-auth.js"></script>

<style>
  body { background:#0f172a; color:#f1f5f9; }
  .glass {
    background:rgba(15,23,42,.8);
    backdrop-filter: blur(18px);
    border-radius:1.5rem;
    border:1px solid rgba(255,255,255,.08);
  }
</style>
</head>

<body class="min-h-screen p-6">

<header class="flex flex-wrap justify-between items-center gap-4 mb-6">
  <h1 class="text-2xl font-bold text-amber-500">
    ðŸ“Š TallerPRO360 Â· Panel CEO
  </h1>
  <button onclick="logout()" class="bg-red-600 px-4 py-2 rounded font-bold">
    Cerrar sesiÃ³n
  </button>
</header>

<!-- KPIs FINANCIEROS -->
<section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 text-center">

  <div class="glass p-4">
    <p>MRR</p>
    <h2 id="mrr" class="text-2xl font-bold text-green-400">$0</h2>
  </div>

  <div class="glass p-4">
    <p>ARR</p>
    <h2 id="arr" class="text-2xl font-bold text-cyan-400">$0</h2>
  </div>

  <div class="glass p-4">
    <p>Talleres Activos</p>
    <h2 id="activos" class="text-2xl font-bold text-emerald-400">0</h2>
  </div>

  <div class="glass p-4">
    <p>BÃ¡sicos</p>
    <h2 id="basicos" class="text-xl font-bold">0</h2>
  </div>

  <div class="glass p-4">
    <p>PRO Mensual</p>
    <h2 id="pros" class="text-xl font-bold">0</h2>
  </div>

  <div class="glass p-4">
    <p>PRO Anual</p>
    <h2 id="proAnuales" class="text-xl font-bold">0</h2>
  </div>

</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAdk-s-OXu57MiobzRGBRu-TlF2KYeicWQ",
  authDomain: "tallerpro360.firebaseapp.com",
  projectId: "tallerpro360",
  storageBucket: "tallerpro360.appspot.com",
  messagingSenderId: "636224778184",
  appId: "1:636224778184:web:9bd7351b6458a1ef625afd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const precios = {
  basico: 29900,
  pro: 59900,
  pro_anual: 599000 / 12
};

async function cargarMetricas() {

  const snapshot = await getDocs(collection(db, "talleres"));

  let activos = 0;
  let ingresosMensuales = 0;
  let basicos = 0;
  let pros = 0;
  let proAnuales = 0;

  snapshot.forEach(doc => {
    const data = doc.data();

    if (data.estado === "activo") {
      activos++;

      if (data.plan === "basico") {
        ingresosMensuales += precios.basico;
        basicos++;
      }

      if (data.plan === "pro") {
        ingresosMensuales += precios.pro;
        pros++;
      }

      if (data.plan === "pro_anual") {
        ingresosMensuales += precios.pro_anual;
        proAnuales++;
      }
    }
  });

  const ingresosAnuales = ingresosMensuales * 12;

  document.getElementById("activos").innerText = activos;
  document.getElementById("mrr").innerText = "$" + ingresosMensuales.toLocaleString();
  document.getElementById("arr").innerText = "$" + ingresosAnuales.toLocaleString();
  document.getElementById("basicos").innerText = basicos;
  document.getElementById("pros").innerText = pros;
  document.getElementById("proAnuales").innerText = proAnuales;
}

cargarMetricas();
</script>

</body>
</html>