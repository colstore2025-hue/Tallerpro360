<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TallerPRO360 | Panel Cliente</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background: linear-gradient(135deg,#0f172a,#111827);
  color:#f1f5f9;
  font-family:'Inter',sans-serif;
}
.glass{
  background: rgba(15,23,42,.7);
  backdrop-filter: blur(20px);
  border-radius: 1.5rem;
  border: 1px solid rgba(255,255,255,.05);
  padding: 1.5rem;
}
.title-gradient{
  background: linear-gradient(90deg,#22c55e,#38bdf8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight:900;
}
.badge-status{
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:700;
}
.badge-ingreso{ background:rgba(59,130,246,.2); color:#38bdf8;}
.badge-proceso{ background:rgba(34,197,94,.2); color:#22c55e;}
.badge-entregado{ background:rgba(250,204,21,.2); color:#facc15;}
button{ border-radius:12px !important; }
input{
  background:#1e293b !important;
  border:1px solid rgba(255,255,255,.1) !important;
  color:#fff !important;
}
</style>
</head>

<body class="p-4">

<div class="container">

<div class="text-center mb-5">
<h1 class="title-gradient">Panel Cliente</h1>
<p class="text-secondary">Gestiona tus órdenes en tiempo real</p>
<button id="logoutBtn" class="btn btn-sm btn-outline-light mt-2 d-none">Cerrar sesión</button>
</div>

<div id="registroCliente" class="glass mb-4">
<h5 class="mb-3">Registrar Cliente</h5>
<form id="formCliente">
<input type="text" id="clienteNombreReg" class="form-control mb-2" placeholder="Nombre completo" required>
<input type="email" id="clienteEmailReg" class="form-control mb-2" placeholder="Correo electrónico" required>
<input type="tel" id="clienteTelefonoReg" class="form-control mb-2" placeholder="Teléfono" required>
<input type="password" id="clientePasswordReg" class="form-control mb-2" placeholder="Contraseña" required>
<button type="submit" class="btn btn-success w-100 mt-2">Registrar</button>
</form>
</div>

<div id="loginCliente" class="glass mb-4">
<h5 class="mb-3">Ingresar</h5>
<form id="formLogin">
<input type="email" id="clienteEmailLogin" class="form-control mb-2" placeholder="Correo electrónico" required>
<input type="password" id="clientePasswordLogin" class="form-control mb-2" placeholder="Contraseña" required>
<button type="submit" class="btn btn-primary w-100 mt-2">Ingresar</button>
</form>
</div>

<div id="crearOrden" class="glass mb-4 d-none">
<h5 class="mb-3">Nueva Orden</h5>
<form id="formOrden">
<input type="text" id="placa" class="form-control mb-2" placeholder="Placa del vehículo" required>
<input type="text" id="vehiculo" class="form-control mb-2" placeholder="Marca / Modelo" required>
<button type="submit" class="btn btn-success w-100 mt-2">Crear Orden</button>
</form>
</div>

<div id="ordenesList" class="glass d-none">
<h5 class="mb-3">Órdenes Activas</h5>
<ul class="list-group bg-transparent" id="ordenesUl"></ul>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
onAuthStateChanged,
signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
getFirestore,
collection,
addDoc,
query,
where,
onSnapshot,
serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyAdk-s-OXu57MiobzRGBRu-TlF2KYeicWQ",
authDomain: "tallerpro360.firebaseapp.com",
projectId: "tallerpro360",
storageBucket: "tallerpro360.appspot.com",
messagingSenderId: "636224778184",
appId: "1:636224778184:web:9bd7351b6458a1ef625afd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const empresaId = "empresa_001";
const sucursalId = "sucursal_001";

const registroDiv = document.getElementById("registroCliente");
const loginDiv = document.getElementById("loginCliente");
const crearOrdenDiv = document.getElementById("crearOrden");
const ordenesListDiv = document.getElementById("ordenesList");
const ordenesUl = document.getElementById("ordenesUl");
const logoutBtn = document.getElementById("logoutBtn");

let unsubscribeOrdenes = null;

/* REGISTRO */
<div id="registroCliente" class="glass mb-4">
<h5 class="mb-4 text-success">Crear Cuenta</h5>

<form id="formCliente">

<div class="form-floating mb-3">
  <input type="text" class="form-control" id="clienteNombreReg" placeholder="Nombre completo" required>
  <label for="clienteNombreReg">Nombre completo</label>
</div>

<div class="form-floating mb-3">
  <input type="email" class="form-control" id="clienteEmailReg" placeholder="Correo electrónico" required>
  <label for="clienteEmailReg">Correo electrónico</label>
</div>

<div class="form-floating mb-3">
  <input type="tel" class="form-control" id="clienteTelefonoReg" placeholder="Teléfono" required>
  <label for="clienteTelefonoReg">Teléfono</label>
</div>

<div class="form-floating mb-3">
  <input type="password" class="form-control" id="clientePasswordReg" placeholder="Contraseña" required>
  <label for="clientePasswordReg">Contraseña</label>
</div>

<button type="submit" class="btn btn-success w-100 py-2">
Crear Cuenta
</button>

</form>
</div>

/* LOGIN */
formLogin.addEventListener("submit", async e=>{
e.preventDefault();
try{
await signInWithEmailAndPassword(auth,clienteEmailLogin.value,clientePasswordLogin.value);
}catch(error){
alert("Error: "+error.message);
}
});

/* LOGOUT */
logoutBtn.addEventListener("click", async ()=>{
await signOut(auth);
});

/* AUTH */
onAuthStateChanged(auth,user=>{
if(user){
registroDiv.classList.add("d-none");
loginDiv.classList.add("d-none");
crearOrdenDiv.classList.remove("d-none");
ordenesListDiv.classList.remove("d-none");
logoutBtn.classList.remove("d-none");
escucharOrdenes(user.uid);
}else{
registroDiv.classList.remove("d-none");
loginDiv.classList.remove("d-none");
crearOrdenDiv.classList.add("d-none");
ordenesListDiv.classList.add("d-none");
logoutBtn.classList.add("d-none");
ordenesUl.innerHTML="";
if(unsubscribeOrdenes) unsubscribeOrdenes();
}
});

/* CREAR ORDEN */
formOrden.addEventListener("submit", async e=>{
e.preventDefault();
try{
const user = auth.currentUser;
await addDoc(collection(db,"empresas",empresaId,"sucursales",sucursalId,"ordenes"),{
uid:user.uid,
placa:placa.value,
vehiculo:vehiculo.value,
estado:"ingreso",
fecha:serverTimestamp()
});
formOrden.reset();
}catch(error){
alert(error.message);
}
});

/* TIEMPO REAL */
function escucharOrdenes(uid){
const q = query(
collection(db,"empresas",empresaId,"sucursales",sucursalId,"ordenes"),
where("uid","==",uid)
);

unsubscribeOrdenes = onSnapshot(q,(snapshot)=>{
ordenesUl.innerHTML="";
snapshot.forEach(doc=>{
const data = doc.data();
const li = document.createElement("li");
li.className="list-group-item bg-transparent text-white d-flex justify-content-between";

let badgeClass="badge-ingreso";
if(data.estado==="proceso") badgeClass="badge-proceso";
if(data.estado==="entregado") badgeClass="badge-entregado";

li.innerHTML=`
<span>${data.placa} - ${data.vehiculo}</span>
<span class="badge-status ${badgeClass}">${data.estado}</span>
`;
ordenesUl.appendChild(li);
});
});
}

</script>

</body>
</html>