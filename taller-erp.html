<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TallerPRO360 | ERP Operativo PRO (Mock Avanzado)</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background: linear-gradient(135deg,#0f172a,#111827);
  color:#f1f5f9;
  font-family:'Inter',sans-serif;
}

.glass{
  background: rgba(15,23,42,.75);
  backdrop-filter: blur(20px);
  border-radius: 1.5rem;
  border: 1px solid rgba(255,255,255,.05);
  padding: 1.5rem;
}

.title-gradient{
  background: linear-gradient(90deg,#22c55e,#38bdf8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight:900;
}

.metric-card{
  text-align:center;
  padding:1rem;
  border-radius:1rem;
  background:rgba(255,255,255,.03);
}

.badge-status{
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:700;
}

.badge-ingreso{ background:rgba(59,130,246,.2); color:#38bdf8;}
.badge-diagnostico{ background:rgba(168,85,247,.2); color:#a855f7;}
.badge-proceso{ background:rgba(34,197,94,.2); color:#22c55e;}
.badge-listo{ background:rgba(234,179,8,.2); color:#facc15;}
.badge-entregado{ background:rgba(250,204,21,.2); color:#fde047;}
.badge-facturado{ background:rgba(244,63,94,.2); color:#f43f5e;}

input, select, textarea{
  background:#0f172a !important;
  border:1px solid rgba(255,255,255,.2) !important;
  color:#fff !important;
}

.form-control:focus{
  border-color:#22c55e !important;
  box-shadow:0 0 0 .25rem rgba(34,197,94,.3) !important;
}
</style>
</head>

<body class="p-4">

<div class="container">

<div class="text-center mb-5">
<h1 class="title-gradient">ERP Operativo PRO</h1>
<p class="text-secondary">Centro de control del taller (Mock Avanzado)</p>
<button id="logoutBtn" class="btn btn-sm btn-outline-light mt-2">Cerrar sesiÃ³n</button>
</div>

<!-- MÃ‰TRICAS -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Ã“rdenes Activas</h6>
      <h2 id="metricOrdenes">0</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Ingresos</h6>
      <h2>$<span id="metricIngresos">0</span></h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Pendiente</h6>
      <h2>$<span id="metricPendiente">0</span></h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Ticket Promedio</h6>
      <h2>$<span id="metricPromedio">0</span></h2>
    </div>
  </div>
</div>

<!-- BUSCADOR -->
<div class="glass mb-4">
<input type="text" id="buscador" class="form-control" placeholder="Buscar por cliente, placa, consecutivo o estado...">
</div>

<!-- CREAR ORDEN -->
<div class="glass mb-4">
<h5>Nueva Orden</h5>
<form id="formOrden">
<input type="text" id="cliente" class="form-control mb-2" placeholder="Nombre cliente" required>
<input type="text" id="telefono" class="form-control mb-2" placeholder="TelÃ©fono cliente" required>
<input type="text" id="placa" class="form-control mb-2" placeholder="Placa" required>
<input type="text" id="vehiculo" class="form-control mb-2" placeholder="VehÃ­culo" required>
<input type="number" id="total" class="form-control mb-2" placeholder="Total estimado" required>
<textarea id="observacion" class="form-control mb-2" placeholder="ObservaciÃ³n inicial"></textarea>
<button type="submit" class="btn btn-success w-100">Crear Orden</button>
</form>
</div>

<!-- LISTADO -->
<div class="glass">
<h5>Ã“rdenes</h5>
<ul class="list-group bg-transparent" id="ordenesUl"></ul>
</div>

</div>

<script type="module">

// =============================================
// ðŸŸ¢ MOCK DATA AVANZADO
// =============================================

const empresaId = "mockEmpresa";
const sucursalId = "mockSucursal";

const estados = ["ingreso","diagnostico","proceso","listo","entregado","facturado"];
let ordenesCache = [
  { 
    id:1, consecutivo:101, cliente:"Juan PÃ©rez", telefono:"3112223333",
    placa:"ABC123", vehiculo:"Chevrolet Spark", estado:"ingreso",
    total:500000, pagado:200000, saldo:300000,
    observaciones: { ingreso:["Recibido con revisiÃ³n inicial"] },
    historial: [{estado:"ingreso", fecha:"2026-02-26 08:00", user:"Admin"}],
    servicios:["Cambio aceite","RevisiÃ³n frenos"], repuestos:["Filtro aceite"]
  },
  { 
    id:2, consecutivo:102, cliente:"MarÃ­a LÃ³pez", telefono:"3124445555",
    placa:"XYZ789", vehiculo:"Renault Logan", estado:"proceso",
    total:750000, pagado:750000, saldo:0,
    observaciones: { ingreso:["Chequeo inicial"], proceso:["Cambio pastillas freno"] },
    historial: [{estado:"ingreso", fecha:"2026-02-25 15:00", user:"Admin"},{estado:"proceso", fecha:"2026-02-26 10:00", user:"Admin"}],
    servicios:["RevisiÃ³n frenos"], repuestos:["Pastillas freno"]
  }
];

// =============================================
// âœ¨ CREAR ORDEN SIMULADA
// =============================================

document.getElementById("formOrden").addEventListener("submit", e=>{
  e.preventDefault();
  const cliente = document.getElementById("cliente").value.trim();
  const telefono = document.getElementById("telefono").value.trim();
  const placa = document.getElementById("placa").value.trim();
  const vehiculo = document.getElementById("vehiculo").value.trim();
  const total = parseFloat(document.getElementById("total").value);
  const observacion = document.getElementById("observacion").value.trim();

  const nuevaOrden = {
    id: ordenesCache.length + 1,
    consecutivo: Date.now(),
    cliente, telefono, placa, vehiculo,
    estado: "ingreso", total, pagado:0, saldo:total,
    observaciones: { ingreso: observacion ? [observacion] : [] },
    historial: [{estado:"ingreso", fecha:new Date().toLocaleString(), user:"Mock"}],
    servicios:[], repuestos:[]
  };

  ordenesCache.unshift(nuevaOrden);
  renderOrdenes(ordenesCache);
  e.target.reset();
  hablar("Orden creada");
});

// =============================================
// âœ¨ RENDER ORDENES
// =============================================

const ordenesUl = document.getElementById("ordenesUl");

function renderOrdenes(lista){
  ordenesUl.innerHTML = "";
  let totalIngresos=0;
  let totalPendiente=0;

  lista.forEach(data=>{
    totalIngresos += data.pagado;
    totalPendiente += data.saldo;

    let badgeClass = "badge-"+data.estado;

    const li = document.createElement("li");
    li.className="list-group-item bg-transparent text-white d-flex flex-column mb-2";
    li.innerHTML=`
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <strong>#${data.consecutivo}</strong> Â· ${data.cliente} Â· ${data.placa} - ${data.vehiculo}
          <br>
          Total: $${data.total} | Pagado: $${data.pagado} | Saldo: $${data.saldo}
        </div>
        <div>
          <span class="badge-status ${badgeClass}">${data.estado}</span>
          <button class="btn btn-sm btn-outline-light ms-2">Estado</button>
          <button class="btn btn-sm btn-success ms-2">Pago</button>
          <button class="btn btn-sm btn-info ms-2">Historial</button>
          <button class="btn btn-sm btn-warning ms-2">Observaciones</button>
        </div>
      </div>
    `;

    // Cambiar estado
    li.querySelector(".btn-outline-light").addEventListener("click", ()=>{
      let index = estados.indexOf(data.estado);
      data.estado = estados[(index+1)%estados.length];
      data.historial.push({estado:data.estado, fecha:new Date().toLocaleString(), user:"Mock"});
      renderOrdenes(ordenesCache);
      hablar("Estado actualizado");
    });

    // Registrar pago
    li.querySelector(".btn-success").addEventListener("click", ()=>{
      const monto = parseFloat(prompt("Ingrese valor recibido:"));
      if(!monto) return;
      data.pagado += monto;
      data.saldo = data.total - data.pagado;
      renderOrdenes(ordenesCache);
      hablar("Pago registrado");
    });

    // Ver historial
    li.querySelector(".btn-info").addEventListener("click", ()=>{
      alert(JSON.stringify(data.historial,null,2));
    });

    // Ver observaciones
    li.querySelector(".btn-warning").addEventListener("click", ()=>{
      let obsText = "";
      for(const key in data.observaciones){
        obsText += key.toUpperCase()+":\n" + data.observaciones[key].join("\n") + "\n\n";
      }
      alert(obsText || "Sin observaciones");
    });

    ordenesUl.appendChild(li);
  });

  // Actualizar mÃ©tricas
  document.getElementById("metricOrdenes").textContent = lista.length;
  document.getElementById("metricIngresos").textContent = totalIngresos.toLocaleString();
  document.getElementById("metricPendiente").textContent = totalPendiente.toLocaleString();
  document.getElementById("metricPromedio").textContent =
    lista.length ? (totalIngresos/lista.length).toFixed(0) : 0;
}

// =============================================
// âœ¨ BUSCADOR
// =============================================
document.getElementById("buscador").addEventListener("input", e=>{
  const texto = e.target.value.toLowerCase();
  const filtradas = ordenesCache.filter(o=>
    o.cliente.toLowerCase().includes(texto) ||
    o.placa.toLowerCase().includes(texto) ||
    String(o.consecutivo).includes(texto) ||
    o.estado.toLowerCase().includes(texto)
  );
  renderOrdenes(filtradas);
});

// =============================================
// âœ¨ VOZ
// =============================================
function hablar(texto){
  const voz = new SpeechSynthesisUtterance(texto);
  voz.lang = "es-ES";
  speechSynthesis.speak(voz);
}

// =============================================
// ðŸŸ¢ INICIAR MOCK
// =============================================
renderOrdenes(ordenesCache);

</script>
</body>
</html>