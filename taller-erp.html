<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TallerPRO360 | ERP Operativo Completo</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background: linear-gradient(135deg,#0f172a,#111827);
  color:#f1f5f9;
  font-family:'Inter',sans-serif;
}
.glass{
  background: rgba(15,23,42,.75);
  backdrop-filter: blur(20px);
  border-radius: 1.5rem;
  border: 1px solid rgba(255,255,255,.05);
  padding: 1.5rem;
  margin-bottom:1rem;
}
.metric-card{
  text-align:center;
  padding:1rem;
  border-radius:1rem;
  background:rgba(255,255,255,.03);
}
.badge-status{
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:700;
}
.badge-ingreso{ background:rgba(59,130,246,.2); color:#38bdf8;}
.badge-diagnostico{ background:rgba(168,85,247,.2); color:#a855f7;}
.badge-proceso{ background:rgba(34,197,94,.2); color:#22c55e;}
.badge-listo{ background:rgba(234,179,8,.2); color:#facc15;}
.badge-entregado{ background:rgba(250,204,21,.2); color:#fde047;}
.badge-facturado{ background:rgba(244,63,94,.2); color:#f43f5e;}
input, select{
  background:#0f172a !important;
  border:1px solid rgba(255,255,255,.2) !important;
  color:#fff !important;
}
.form-control:focus{
  border-color:#22c55e !important;
  box-shadow:0 0 0 .25rem rgba(34,197,94,.3) !important;
}
</style>
</head>
<body class="p-4">

<div class="container">
<h1 class="text-center mb-4">ERP Operativo PRO - Mock Completo</h1>

<!-- DASHBOARD -->
<div class="row mb-4" id="dashboard">
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Ã“rdenes Activas</h6>
      <h2 id="metricOrdenes">0</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Ingresos Totales</h6>
      <h2>$<span id="metricIngresos">0</span></h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Pendiente</h6>
      <h2>$<span id="metricPendiente">0</span></h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="metric-card glass">
      <h6>Ticket Promedio</h6>
      <h2>$<span id="metricPromedio">0</span></h2>
    </div>
  </div>
</div>

<!-- FORMULARIO ORDEN -->
<div class="glass">
<h5>Nueva Orden</h5>
<form id="formOrden">
<input type="text" id="clienteNombre" class="form-control mb-2" placeholder="Nombre del cliente" required>
<input type="text" id="clienteTelefono" class="form-control mb-2" placeholder="TelÃ©fono" required>
<input type="text" id="placa" class="form-control mb-2" placeholder="Placa del vehÃ­culo" required>
<input type="text" id="vehiculoModelo" class="form-control mb-2" placeholder="Modelo del vehÃ­culo" required>
<input type="text" id="vehiculoColor" class="form-control mb-2" placeholder="Color del vehÃ­culo">
<input type="number" id="vehiculoAno" class="form-control mb-2" placeholder="AÃ±o del vehÃ­culo">
<input type="text" id="tecnicoAsignado" class="form-control mb-2" placeholder="TÃ©cnico asignado">
<input type="text" id="repuestos" class="form-control mb-2" placeholder="Repuestos separados (coma ,)">
<input type="number" id="total" class="form-control mb-2" placeholder="Total estimado" required>
<button type="submit" class="btn btn-success w-100">Crear Orden</button>
</form>
</div>

<!-- BUSCADOR -->
<div class="glass mb-3">
<input type="text" id="buscador" class="form-control" placeholder="Buscar por placa, consecutivo o estado...">
</div>

<!-- LISTADO DE Ã“RDENES -->
<div class="glass">
<h5>Ã“rdenes</h5>
<ul class="list-group bg-transparent" id="ordenesUl"></ul>
</div>

</div>

<script type="module">
// =============================================
// ðŸŸ¢ MOCK DATA COMPLETO
// =============================================
const estados = ["ingreso","diagnostico","proceso","listo","entregado","facturado"];
let ordenesCache = [
  { 
    id:1, consecutivo:101, cliente:"Juan Perez", telefono:"3111111111",
    placa:"ABC123", modelo:"Chevrolet Spark", color:"Blanco", ano:2020,
    estado:"ingreso", total:500000, pagado:200000, saldo:300000,
    tecnico:"Carlos", repuestos:["Filtro aceite","Aceite motor"],
    historial:[{estado:"ingreso", fecha:new Date(), notas:"Orden creada"}]
  },
  { 
    id:2, consecutivo:102, cliente:"Ana Gomez", telefono:"3222222222",
    placa:"XYZ789", modelo:"Renault Logan", color:"Rojo", ano:2018,
    estado:"proceso", total:750000, pagado:750000, saldo:0,
    tecnico:"Luis", repuestos:["Pastillas freno"],
    historial:[{estado:"ingreso", fecha:new Date(), notas:"Orden creada"},
              {estado:"diagnostico", fecha:new Date(), notas:"DiagnÃ³stico realizado"},
              {estado:"proceso", fecha:new Date(), notas:"ReparaciÃ³n en curso"}]
  }
];

// =============================================
// âœ¨ CREAR NUEVA ORDEN
// =============================================
document.getElementById("formOrden").addEventListener("submit", e=>{
  e.preventDefault();
  const nuevaOrden = {
    id: ordenesCache.length + 1,
    consecutivo: Date.now(),
    cliente: document.getElementById("clienteNombre").value.trim(),
    telefono: document.getElementById("clienteTelefono").value.trim(),
    placa: document.getElementById("placa").value.trim(),
    modelo: document.getElementById("vehiculoModelo").value.trim(),
    color: document.getElementById("vehiculoColor").value.trim(),
    ano: parseInt(document.getElementById("vehiculoAno").value),
    tecnico: document.getElementById("tecnicoAsignado").value.trim(),
    repuestos: document.getElementById("repuestos").value.split(",").map(r=>r.trim()).filter(r=>r),
    estado: "ingreso",
    total: parseFloat(document.getElementById("total").value),
    pagado:0,
    saldo: parseFloat(document.getElementById("total").value),
    historial:[{estado:"ingreso", fecha:new Date(), notas:"Orden creada"}]
  };
  ordenesCache.unshift(nuevaOrden);
  renderOrdenes(ordenesCache);
  e.target.reset();
  hablar("Orden creada");
});

// =============================================
// âœ¨ RENDER Ã“RDENES
// =============================================
const ordenesUl = document.getElementById("ordenesUl");
function renderOrdenes(lista){
  ordenesUl.innerHTML = "";
  let totalIngresos=0, totalPendiente=0;

  lista.forEach(data=>{
    totalIngresos += data.pagado;
    totalPendiente += data.saldo;

    let badgeClass = "badge-"+data.estado;
    const li = document.createElement("li");
    li.className="list-group-item bg-transparent text-white d-flex flex-column mb-2";
    li.innerHTML=`
      <div class="d-flex justify-content-between align-items-center">
        <div><strong>#${data.consecutivo}</strong> Â· ${data.cliente} (${data.telefono})<br>
        ${data.placa} - ${data.modelo} ${data.color} (${data.ano})</div>
        <div><span class="badge-status ${badgeClass}">${data.estado}</span></div>
      </div>
      <div class="mt-2">
        <strong>TÃ©cnico:</strong> ${data.tecnico || "-"} <br>
        <strong>Repuestos:</strong> ${data.repuestos.join(", ") || "-"} <br>
        <strong>Total:</strong> $${data.total} | <strong>Pagado:</strong> $${data.pagado} | <strong>Saldo:</strong> $${data.saldo}
      </div>
      <div class="mt-2">
        <button class="btn btn-sm btn-outline-light me-2">Cambiar Estado</button>
        <button class="btn btn-sm btn-success me-2">Registrar Pago</button>
        <button class="btn btn-sm btn-warning">Agregar Repuesto</button>
      </div>
      <details class="mt-2 text-slate-400">
        <summary>Historial</summary>
        <ul id="historial-${data.id}"></ul>
      </details>
    `;

    // Render historial
    const histUl = li.querySelector(`#historial-${data.id}`);
    data.historial.forEach(h=>{
      const lih = document.createElement("li");
      lih.textContent = `${h.estado} - ${h.fecha.toLocaleString()} : ${h.notas}`;
      histUl.appendChild(lih);
    });

    // Cambiar estado
    li.querySelector(".btn-outline-light").addEventListener("click", ()=>{
      let index = estados.indexOf(data.estado);
      data.estado = estados[(index+1)%estados.length];
      data.historial.push({estado:data.estado, fecha:new Date(), notas:"Estado actualizado"});
      renderOrdenes(ordenesCache);
      hablar("Estado actualizado");
    });

    // Registrar pago
    li.querySelector(".btn-success").addEventListener("click", ()=>{
      const monto = parseFloat(prompt("Ingrese valor recibido:"));
      if(!monto) return;
      data.pagado += monto;
      data.saldo = data.total - data.pagado;
      data.historial.push({estado:data.estado, fecha:new Date(), notas:`Pago registrado: $${monto}`});
      renderOrdenes(ordenesCache);
      hablar("Pago registrado");
    });

    // Agregar repuesto
    li.querySelector(".btn-warning").addEventListener("click", ()=>{
      const rep = prompt("Ingrese repuesto a agregar:");
      if(!rep) return;
      data.repuestos.push(rep);
      data.historial.push({estado:data.estado, fecha:new Date(), notas:`Repuesto agregado: ${rep}`});
      renderOrdenes(ordenesCache);
      hablar("Repuesto agregado");
    });

    ordenesUl.appendChild(li);
  });

  // Actualizar mÃ©tricas
  document.getElementById("metricOrdenes").textContent = lista.length;
  document.getElementById("metricIngresos").textContent = totalIngresos.toLocaleString();
  document.getElementById("metricPendiente").textContent = totalPendiente.toLocaleString();
  document.getElementById("metricPromedio").textContent =
    lista.length ? (totalIngresos/lista.length).toFixed(0) : 0;
}

// =============================================
// âœ¨ BUSCADOR
// =============================================
document.getElementById("buscador").addEventListener("input", e=>{
  const texto = e.target.value.toLowerCase();
  const filtradas = ordenesCache.filter(o=>
    o.placa.toLowerCase().includes(texto) ||
    o.cliente.toLowerCase().includes(texto) ||
    String(o.consecutivo).includes(texto) ||
    o.estado.toLowerCase().includes(texto)
  );
  renderOrdenes(filtradas);
});

// =============================================
// âœ¨ VOZ
// =============================================
function hablar(texto){
  const voz = new SpeechSynthesisUtterance(texto);
  voz.lang = "es-ES";
  speechSynthesis.speak(voz);
}

// =============================================
// ðŸŸ¢ INIT
// =============================================
renderOrdenes(ordenesCache);

</script>

</body>
</html>