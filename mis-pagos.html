<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mis Pagos</title>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
      getFirestore, 
      collection, 
      query, 
      where, 
      orderBy, 
      getDocs 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAdk-s-OXu57MiobzRGBRu-TlF2KYeicWQ",
  authDomain: "tallerpro360.firebaseapp.com",
  projectId: "tallerpro360",
  storageBucket: "tallerpro360.appspot.com",
  messagingSenderId: "636224778184",
  appId: "1:636224778184:web:9bd7351b6458a1ef625afd"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const q = query(
        collection(db, "pagos"),
        where("uid", "==", user.uid),
        orderBy("creadoEn", "desc")
      );

      const snapshot = await getDocs(q);
      const lista = document.getElementById("listaPagos");
      lista.innerHTML = "";

      snapshot.forEach((doc) => {
        const p = doc.data();
        const fecha = p.creadoEn?.toDate();

        const div = document.createElement("div");
        div.style.border = "1px solid #ccc";
        div.style.margin = "10px";
        div.style.padding = "10px";

        div.innerHTML = `
          <p><strong>Plan:</strong> ${p.plan}</p>
          <p><strong>Monto:</strong> ${new Intl.NumberFormat("es-CO", {
            style: "currency",
            currency: "COP"
          }).format(p.monto)}</p>
          <p><strong>Estado:</strong> ${p.estado}</p>
          <p><strong>Fecha:</strong> ${fecha ? fecha.toLocaleString() : "-"}</p>
        `;

        lista.appendChild(div);
      });
    });
  </script>
</head>
<body>

  <h2>Mis Pagos</h2>
  <div id="listaPagos"></div>

</body>
</html>